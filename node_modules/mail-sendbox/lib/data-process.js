var mailData = require('./data-process/mail-data.js');
var transportData = require('./data-process/transport-data.js');

var dataProcess = function( receivedData ) {

    /**
     * @returns {string}
     */
    this.getCommand = function() {
        var command = receivedData.command;
        if (command == undefined)
            throw new Error("In suck message command doesn't exist");
        if (typeof command !== "string")
            throw new Error("Command must be typeof string");
        return command.toUpperCase();
    };

    /**
     * @returns {TransportData}
     */
    this.getTransportData = function() {
        var data = transportData.init( receivedData.config );
        data.validate();
        data.prepareFormat();
        return data;
    };

    /**
     * @returns {MailData}
     */
    this.getMailData = function() {
        var data = mailData.init( receivedData.message );
        data.validate();
        data.prepareFormat();
        return data;
    };

    // construct
    (function() {
        var stringData = receivedData;
        try {
            receivedData = JSON.parse( stringData )
        } catch(e) {
            throw new Error('Data must be in JSON format. Receive - ' + stringData);
        }
    })();

};

module.exports.processData = function(receivedData) {
    return new dataProcess( receivedData );
};