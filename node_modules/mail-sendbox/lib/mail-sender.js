var nodemailer = require("nodemailer");

var mailSender = function() {

    /**
     * @param {transportData} transportData
     * @return {Transport}
     */
    this.getTransport = function( transportData ) {
        var _preparedTransportData = {};
        switch (transportData.getHost()) {
            case 'smtp.gmail.com':
                _preparedTransportData = {
                    service: "Gmail",
                    auth: transportData.getAuthParams()
                };
                break;
            default:
                throw new Error('We don\'t support such host');
                break;
        }
        return nodemailer.createTransport("SMTP", _preparedTransportData);
    };

    /**
     * @param {Transport} transport
     * @param {MailData} mailData
     * @param {Function} callback
     */
    this.sendMail = function(transport, mailData, callback) {
        transport.sendMail(mailData.getPreparedMailParams(), function(error, response) {
            if (error) {
                throw error;
            } else {
                callback ? callback( response ) : undefined;
            }
        });
    };

};

/**
 * @param {Transport} transportData
 * @param {MailData} mailData
 * @param {Function} callback
 */
module.exports.sendMail = function(transportData, mailData, callback) {
    var sender = new mailSender();
    var transport = sender.getTransport( transportData );
    sender.sendMail( transport, mailData, callback );
    transport.close();
};